---
title: "데이터 중심 아키텍처 : 8.복제"
date: 2024-01-03 16:00:00 +0400
categories: study, architecture, db
tags: study, architecture, db
---

# 08. 분산 시스템의 골칫거리
- 분산 시스템 : 비공유 시스템, 네트워크로만 연결된 다수의 장비
## 클라우드 컴퓨팅과 슈퍼컴퓨팅
- 분산 시스템이 동작하게 만들려면 부분 장애 가능성을 받아들이고, 소프트웨어에 내결함성 메커니즘을 넣어야한다.
- 결함처리는 소프트웨어 설계의 일부이어야하며, 소프트웨어 운영자로써 결함이 발생하면 소프트웨어가 어떻게 동작할지 알아야한다.
## 신뢰성 없는 네트워크
- 다른 노드로 요청을 보내서 응답을 받지 못했다면, 그 이유를 아는것은 불가능하다.
    - ex) 요청이 손실되었는지, 원격노드가 다운되어 도달하지 못했는지, 응답이 손실되었는지 등.
    - 일반적으로 타임아웃이 이 문제를 다루는 방법
## 현실의 네트워크 결함
- 네트워크 결함(분단,분리) : 네트워크의 일부가 다른쪽과 차단되는것.
- 소프트웨어가 네트워크 문제에 어떻게 반응하는지 알고 시스템이 그로부터 복구할수있도록 보장해야한다. > 카오스몽키의 기반이되는 생각
## 결함 감지
- TCP ACK만으로 요청의 성공을 확신하지 말고, 애플리케이션 수준에서 긍정 응답을 받아야한다.
- 원격노드가 다운되고있다는 빠른 피드백은 유용하지만, 의존할 수 없으므로 타임아웃으로 관리할 수 있다.
> 일시적 타임아웃으로 복구될 수 있는 연결이 끊어지는 상황이 있었고 재발 방지로 타임아웃을 무제한급으로 늘리려했던적이있는데, 당연하겠지만 타임아웃의 취지를 다시 생각해보고 적절한 값을 찾는게 좋겠다.
## 타임아웃과 기약없는 지연
- 이미 높은 부하가 주어진 상황이라면 타임아웃이 짧은경우, 죽었다고 판단된 노드의 부하를 다른 노드가 추가로 받아야해서 악순환이 될 수 있다.
- 네트워크 왕복시간의 분포를 측정하여, 적절한 트레이드 오프가 필요.
- 동적 타임아웃 솔루션도 있음. 파이증가 장애감지기 (Akka와 Casnadra가 사용중)
+ 네트워크 혼잡과 큐 대기 : 트래픽 증가 -> 큐 지연 -> TCP타임아웃으로 재전송, 트래픽 더증가 ..
## 동기 네트워크 vs 비동기 네트워크
- 동기식 : 전화통화, 회선이 만들어져서 대역폭이 할당된다. 
    - bounded delay : 큐 대기문제가 없어 종간 지연시간의 최대치가 고정값이다. 
- 비동기식 : TCP, 패킷 교환 프로토콜. 가용한 네트워크 대역폭을 기회주의적으로 사용한다.
    - 왜 패킷교환을 사용할까? 순간적으로 몰리는 트래픽에 최적화되어있기 때문.
        - 회선을 쓰면 대역폭 할당을 추정해야하는데, 추정치가 높으면 낭비, 낮으면 전송이 느려지므로 순간적으로 몰리는 데이터 전송에 적합하지 않다.
- 회선 + 패킷교환을 시도한 ATM(Asynchronous Transfer Mode ,은행아님)도 있다. 우선순위 패킷, 전송측에서 전송률 제한을 잘 사용하면됨.
## 신뢰성 없는 시계

